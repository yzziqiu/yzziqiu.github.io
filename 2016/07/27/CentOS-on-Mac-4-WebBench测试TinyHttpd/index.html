<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="vim,opensource,WebBench,TinyHttpd,wget," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="早有听闻WebBench和TinyHttpd是工程师不得不了解的十大优秀C语言开源项目出乎我意料的是，两个项目的代目都十分精简约在400行左右，而且稳定性极高，将近十年未更新  任务：1.编译运行WebBench并了解注释WebBench源代码2.编译运行TinyHttpd并了解注释TinyHttpd源代码3.用编译的WebBench测试编译的TinyHttpd">
<meta name="keywords" content="vim,opensource,WebBench,TinyHttpd,wget">
<meta property="og:type" content="article">
<meta property="og:title" content="CentOS on Mac#4.WebBench测试TinyHttpd ">
<meta property="og:url" content="http://yzziqiu.github.io/2016/07/27/CentOS-on-Mac-4-WebBench测试TinyHttpd/index.html">
<meta property="og:site_name" content="Izzy Notes">
<meta property="og:description" content="早有听闻WebBench和TinyHttpd是工程师不得不了解的十大优秀C语言开源项目出乎我意料的是，两个项目的代目都十分精简约在400行左右，而且稳定性极高，将近十年未更新  任务：1.编译运行WebBench并了解注释WebBench源代码2.编译运行TinyHttpd并了解注释TinyHttpd源代码3.用编译的WebBench测试编译的TinyHttpd">
<meta property="og:locale" content="en">
<meta property="og:image" content="http://img.blog.csdn.net/20160727222008648">
<meta property="og:image" content="http://img.blog.csdn.net/20160727222044258">
<meta property="og:image" content="http://img.blog.csdn.net/20160727222105836">
<meta property="og:image" content="http://img.blog.csdn.net/20160727222211874">
<meta property="og:image" content="http://img.blog.csdn.net/20160727222225743">
<meta property="og:image" content="http://img.blog.csdn.net/20160727222343517">
<meta property="og:image" content="http://img.blog.csdn.net/20160727222420932">
<meta property="og:image" content="http://img.blog.csdn.net/20160727223111870">
<meta property="og:image" content="http://img.blog.csdn.net/20160727223131620">
<meta property="og:image" content="http://img.blog.csdn.net/20160727223146120">
<meta property="og:image" content="http://img.blog.csdn.net/20160727223156889">
<meta property="og:image" content="http://img.blog.csdn.net/20160730210123873">
<meta property="og:image" content="http://img.blog.csdn.net/20160730210257235">
<meta property="og:image" content="http://img.blog.csdn.net/20160730210313016">
<meta property="og:image" content="http://img.blog.csdn.net/20160730211549112">
<meta property="og:image" content="http://img.blog.csdn.net/20160730212735910">
<meta property="og:image" content="http://img.blog.csdn.net/20160730212834364">
<meta property="og:image" content="http://img.blog.csdn.net/20160730213630744">
<meta property="og:image" content="http://img.blog.csdn.net/20160730213753057">
<meta property="og:image" content="http://img.blog.csdn.net/20160730214014480">
<meta property="og:image" content="http://img.blog.csdn.net/20160730214417824">
<meta property="og:updated_time" content="2017-10-21T04:55:21.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="CentOS on Mac#4.WebBench测试TinyHttpd ">
<meta name="twitter:description" content="早有听闻WebBench和TinyHttpd是工程师不得不了解的十大优秀C语言开源项目出乎我意料的是，两个项目的代目都十分精简约在400行左右，而且稳定性极高，将近十年未更新  任务：1.编译运行WebBench并了解注释WebBench源代码2.编译运行TinyHttpd并了解注释TinyHttpd源代码3.用编译的WebBench测试编译的TinyHttpd">
<meta name="twitter:image" content="http://img.blog.csdn.net/20160727222008648">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yzziqiu.github.io/2016/07/27/CentOS-on-Mac-4-WebBench测试TinyHttpd/"/>





  <title>CentOS on Mac#4.WebBench测试TinyHttpd  | Izzy Notes</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Izzy Notes</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Just a girl with a laptop</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yzziqiu.github.io/2016/07/27/CentOS-on-Mac-4-WebBench测试TinyHttpd/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Izzy Qiu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/and.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Izzy Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">CentOS on Mac#4.WebBench测试TinyHttpd </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-07-27T22:37:04+08:00">
                2016-07-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Tech/" itemprop="url" rel="index">
                    <span itemprop="name">Tech</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>早有听闻WebBench和TinyHttpd是工程师不得不了解的十大优秀C语言开源项目<br>出乎我意料的是，两个项目的代目都十分精简约在400行左右，而且稳定性极高，将近十年未更新</p>
<blockquote>
<p>任务：<br>1.编译运行WebBench并了解注释WebBench源代码<br>2.编译运行TinyHttpd并了解注释TinyHttpd源代码<br>3.用编译的WebBench测试编译的TinyHttpd</p>
</blockquote>
<a id="more"></a>
<p>那就先说WebBench咯~</p>
<p><strong>WebBench</strong><br>源码在此<br><a href="http://home.tiscali.cz/~cz210552/webbench.html" target="_blank" rel="external">http://home.tiscali.cz/~cz210552/webbench.html</a></p>
<p><strong>编译运行</strong><br>步骤如下<br>1.在网站上下载源代码<br><code>wget http://home.tiscali.cz/~cz210552/distfiles/webbench-1.5.tar.gz</code></p>
<p><img src="http://img.blog.csdn.net/20160727222008648" alt="这里写图片描述"></p>
<p>2.解压<br><code>tar  zxvf webbench-1.5.tar.gz</code><br>//tinyhttpd同理</p>
<p><img src="http://img.blog.csdn.net/20160727222044258" alt="这里写图片描述"></p>
<p>3.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cd webbench-1.5</div></pre></td></tr></table></figure>
<p>4.make文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">make</div></pre></td></tr></table></figure>
<p><img src="http://img.blog.csdn.net/20160727222105836" alt="这里写图片描述"><br>(1)<br>出现找不到ctags或gcc</p>
<blockquote>
<p>yum install ctags</p>
</blockquote>
<p><img src="http://img.blog.csdn.net/20160727222211874" alt="这里写图片描述"><br>5.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">make install</div></pre></td></tr></table></figure>
<p>(2)error 1</p>
<blockquote>
<p>mkdir -m 644 -p /usr/local/man/man1</p>
</blockquote>
<p><img src="http://img.blog.csdn.net/20160727222225743" alt="这里写图片描述"><br><strong>WebBench使用</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">webbench -c 1000 -t 60 http://www.baidu.com/index.html</div></pre></td></tr></table></figure>
<p>webbench -c 并发数 -t 运行测试时间 URL</p>
<p>x可以直接输3w或者IP地址<br>通过ping获取IP地址</p>
<p><img src="http://img.blog.csdn.net/20160727222343517" alt="这里写图片描述"></p>
<p><img src="http://img.blog.csdn.net/20160727222420932" alt="这里写图片描述"></p>
<p>开始测试<strong>baidu服务器的抗压性能</strong><br>注意IP地址跟域名是一样的意思</p>
<p>咱们先试一下100个用户30s测试</p>
<p><img src="http://img.blog.csdn.net/20160727223111870" alt="这里写图片描述"></p>
<p>可以看出全都成功了</p>
<p>1000个用户30s测试</p>
<p><img src="http://img.blog.csdn.net/20160727223131620" alt="这里写图片描述"></p>
<p>=v=结果如图</p>
<p>100个用户60s测试<br><img src="http://img.blog.csdn.net/20160727223146120" alt="这里写图片描述"></p>
<p>10%左右的成功率。。</p>
<p>前方高能WebBench400多行的<br><strong>！！！源码分析！！！！</strong></p>
<p><strong>//socket.c</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line">/* $Id: socket.c 1.1 1995/01/01 07:11:14 cthuang Exp $</div><div class="line"> *</div><div class="line"> * This module has been modified by Radim Kolar for OS/2 emx</div><div class="line"> */</div><div class="line"></div><div class="line">/***********************************************************************</div><div class="line">  module:       socket.c</div><div class="line">  program:      popclient</div><div class="line">  SCCS ID:      @(#)socket.c    1.5  4/1/94</div><div class="line">  programmer:   Virginia Tech Computing Center</div><div class="line">  compiler:     DEC RISC C compiler (Ultrix 4.1)</div><div class="line">  environment:  DEC Ultrix 4.3</div><div class="line">  description:  UNIX sockets code.</div><div class="line"> ***********************************************************************/</div><div class="line"></div><div class="line">#include &lt;sys/types.h&gt;</div><div class="line">#include &lt;sys/socket.h&gt;</div><div class="line">#include &lt;fcntl.h&gt;</div><div class="line">#include &lt;netinet/in.h&gt;</div><div class="line">#include &lt;arpa/inet.h&gt;</div><div class="line">#include &lt;netdb.h&gt;</div><div class="line">#include &lt;sys/time.h&gt;</div><div class="line">#include &lt;string.h&gt;</div><div class="line">#include &lt;unistd.h&gt;</div><div class="line">#include &lt;stdio.h&gt;</div><div class="line">#include &lt;stdlib.h&gt;</div><div class="line">#include &lt;stdarg.h&gt;</div><div class="line">//连接类型为TCP，使用IPv4网域</div><div class="line"> //host为服务器ip，clientPort建立socket连接</div><div class="line">int Socket(const char *host, int clientPort)</div><div class="line">&#123;</div><div class="line">    int sock;</div><div class="line">    unsigned long inaddr;</div><div class="line">    struct sockaddr_in ad;</div><div class="line">    struct hostent *hp;</div><div class="line"></div><div class="line">    memset(&amp;ad, 0, sizeof(ad));</div><div class="line">    ad.sin_family = AF_INET;</div><div class="line"></div><div class="line">    inaddr = inet_addr(host);</div><div class="line">    if (inaddr != INADDR_NONE)</div><div class="line">        memcpy(&amp;ad.sin_addr, &amp;inaddr, sizeof(inaddr));</div><div class="line">    else</div><div class="line">    &#123;</div><div class="line">        hp = gethostbyname(host); //域名获取IP</div><div class="line">        if (hp == NULL)</div><div class="line">            return -1;</div><div class="line">        memcpy(&amp;ad.sin_addr, hp-&gt;h_addr, hp-&gt;h_length);</div><div class="line">    &#125;</div><div class="line">    ad.sin_port = htons(clientPort);</div><div class="line"></div><div class="line">    sock = socket(AF_INET, SOCK_STREAM, 0);</div><div class="line">    if (sock &lt; 0)</div><div class="line">        return sock;</div><div class="line">    if (connect(sock, (struct sockaddr *)&amp;ad, sizeof(ad)) &lt; 0)</div><div class="line">        return -1;  //出错返回－1</div><div class="line">    return sock;   //正常连接，返回socket连接符</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>－－－－－－－－－－－－－－－－－－－－－－－－</p>
<p><strong>//webbench.c</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div><div class="line">352</div><div class="line">353</div><div class="line">354</div><div class="line">355</div><div class="line">356</div><div class="line">357</div><div class="line">358</div><div class="line">359</div><div class="line">360</div><div class="line">361</div><div class="line">362</div><div class="line">363</div><div class="line">364</div><div class="line">365</div><div class="line">366</div><div class="line">367</div><div class="line">368</div><div class="line">369</div><div class="line">370</div><div class="line">371</div><div class="line">372</div><div class="line">373</div><div class="line">374</div><div class="line">375</div><div class="line">376</div><div class="line">377</div><div class="line">378</div><div class="line">379</div><div class="line">380</div><div class="line">381</div><div class="line">382</div><div class="line">383</div><div class="line">384</div><div class="line">385</div><div class="line">386</div><div class="line">387</div><div class="line">388</div><div class="line">389</div><div class="line">390</div><div class="line">391</div><div class="line">392</div><div class="line">393</div><div class="line">394</div><div class="line">395</div><div class="line">396</div><div class="line">397</div><div class="line">398</div><div class="line">399</div><div class="line">400</div><div class="line">401</div><div class="line">402</div><div class="line">403</div><div class="line">404</div><div class="line">405</div><div class="line">406</div><div class="line">407</div><div class="line">408</div><div class="line">409</div><div class="line">410</div><div class="line">411</div><div class="line">412</div><div class="line">413</div><div class="line">414</div><div class="line">415</div><div class="line">416</div><div class="line">417</div><div class="line">418</div><div class="line">419</div><div class="line">420</div><div class="line">421</div><div class="line">422</div><div class="line">423</div><div class="line">424</div><div class="line">425</div><div class="line">426</div><div class="line">427</div><div class="line">428</div><div class="line">429</div><div class="line">430</div><div class="line">431</div><div class="line">432</div><div class="line">433</div><div class="line">434</div><div class="line">435</div><div class="line">436</div><div class="line">437</div><div class="line">438</div><div class="line">439</div><div class="line">440</div><div class="line">441</div><div class="line">442</div><div class="line">443</div><div class="line">444</div><div class="line">445</div><div class="line">446</div><div class="line">447</div><div class="line">448</div><div class="line">449</div><div class="line">450</div><div class="line">451</div><div class="line">452</div><div class="line">453</div><div class="line">454</div><div class="line">455</div></pre></td><td class="code"><pre><div class="line">/*</div><div class="line"> * (C) Radim Kolar 1997-2004</div><div class="line"> * This is free software, see GNU Public License version 2 for</div><div class="line"> * details.</div><div class="line"> *</div><div class="line"> * Simple forking WWW Server benchmark:</div><div class="line"> *</div><div class="line"> * Usage:</div><div class="line"> *   webbench --help</div><div class="line"> *</div><div class="line"> * Return codes:</div><div class="line"> *    0 - sucess</div><div class="line"> *    1 - benchmark failed (server is not on-line)</div><div class="line"> *    2 - bad param</div><div class="line"> *    3 - internal error, fork failed</div><div class="line"> *</div><div class="line"> */</div><div class="line">#include &quot;socket.c&quot;</div><div class="line">#include &lt;unistd.h&gt;</div><div class="line">#include &lt;sys/param.h&gt;</div><div class="line">#include &lt;rpc/types.h&gt;</div><div class="line">#include &lt;getopt.h&gt;</div><div class="line">#include &lt;strings.h&gt;</div><div class="line">#include &lt;time.h&gt;</div><div class="line">#include &lt;signal.h&gt;</div><div class="line"></div><div class="line">/* values */</div><div class="line">volatile int timerexpired=0;</div><div class="line">int speed=0;</div><div class="line">int failed=0;</div><div class="line">int bytes=0;</div><div class="line">/* globals */</div><div class="line">int http10=1; /* 0 - http/0.9, 1 - http/1.0, 2 - http/1.1 */  </div><div class="line">/* Allow: GET, HEAD, OPTIONS, TRACE */</div><div class="line">#define METHOD_GET 0</div><div class="line">#define METHOD_HEAD 1</div><div class="line">#define METHOD_OPTIONS 2</div><div class="line">#define METHOD_TRACE 3</div><div class="line">#define PROGRAM_VERSION &quot;1.5&quot;</div><div class="line">int method=METHOD_GET; //方法</div><div class="line">int clients=1;  //并发数</div><div class="line">int force=0; //等待服务器应答</div><div class="line">int force_reload=0;</div><div class="line">int proxyport=80;  //代理服务器端口</div><div class="line">char *proxyhost=NULL; //代理服务器地址</div><div class="line">int benchtime=30; //运行时间</div><div class="line">/* internal */</div><div class="line">int mypipe[2];</div><div class="line">char host[MAXHOSTNAMELEN];</div><div class="line">#define REQUEST_SIZE 2048</div><div class="line">char request[REQUEST_SIZE];</div><div class="line">//方法选择</div><div class="line">static const struct option long_options[]=</div><div class="line">&#123;</div><div class="line"> &#123;&quot;force&quot;,no_argument,&amp;force,1&#125;,</div><div class="line"> &#123;&quot;reload&quot;,no_argument,&amp;force_reload,1&#125;,</div><div class="line"> &#123;&quot;time&quot;,required_argument,NULL,&apos;t&apos;&#125;,</div><div class="line"> &#123;&quot;help&quot;,no_argument,NULL,&apos;?&apos;&#125;,</div><div class="line"> &#123;&quot;http09&quot;,no_argument,NULL,&apos;9&apos;&#125;,</div><div class="line"> &#123;&quot;http10&quot;,no_argument,NULL,&apos;1&apos;&#125;,</div><div class="line"> &#123;&quot;http11&quot;,no_argument,NULL,&apos;2&apos;&#125;,</div><div class="line"> &#123;&quot;get&quot;,no_argument,&amp;method,METHOD_GET&#125;,</div><div class="line"> &#123;&quot;head&quot;,no_argument,&amp;method,METHOD_HEAD&#125;,</div><div class="line"> &#123;&quot;options&quot;,no_argument,&amp;method,METHOD_OPTIONS&#125;,</div><div class="line"> &#123;&quot;trace&quot;,no_argument,&amp;method,METHOD_TRACE&#125;,</div><div class="line"> &#123;&quot;version&quot;,no_argument,NULL,&apos;V&apos;&#125;,</div><div class="line"> &#123;&quot;proxy&quot;,required_argument,NULL,&apos;p&apos;&#125;,</div><div class="line"> &#123;&quot;clients&quot;,required_argument,NULL,&apos;c&apos;&#125;,</div><div class="line"> &#123;NULL,0,NULL,0&#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">/* prototypes */</div><div class="line">static void benchcore(const char* host,const int port, const char *request);</div><div class="line">static int bench(void);</div><div class="line">static void build_request(const char *url);</div><div class="line"></div><div class="line">static void alarm_handler(int signal)</div><div class="line">&#123;</div><div class="line">   timerexpired=1;</div><div class="line">&#125;</div><div class="line">//调用方法</div><div class="line">static void usage(void)</div><div class="line">&#123;</div><div class="line">   fprintf(stderr,</div><div class="line">&quot;webbench [option]... URL\n&quot;</div><div class="line">&quot;  -f|--force               Don&apos;t wait for reply from server.\n&quot;</div><div class="line">&quot;  -r|--reload              Send reload request - Pragma: no-cache.\n&quot;</div><div class="line">&quot;  -t|--time &lt;sec&gt;          Run benchmark for &lt;sec&gt; seconds. Default 30.\n&quot;</div><div class="line">&quot;  -p|--proxy &lt;server:port&gt; Use proxy server for request.\n&quot;</div><div class="line">&quot;  -c|--clients &lt;n&gt;         Run &lt;n&gt; HTTP clients at once. Default one.\n&quot;</div><div class="line">&quot;  -9|--http09              Use HTTP/0.9 style requests.\n&quot;</div><div class="line">&quot;  -1|--http10              Use HTTP/1.0 protocol.\n&quot;</div><div class="line">&quot;  -2|--http11              Use HTTP/1.1 protocol.\n&quot;</div><div class="line">&quot;  --get                    Use GET request method.\n&quot;</div><div class="line">&quot;  --head                   Use HEAD request method.\n&quot;</div><div class="line">&quot;  --options                Use OPTIONS request method.\n&quot;</div><div class="line">&quot;  --trace                  Use TRACE request method.\n&quot;</div><div class="line">&quot;  -?|-h|--help             This information.\n&quot;</div><div class="line">&quot;  -V|--version             Display program version.\n&quot;</div><div class="line">);</div><div class="line">&#125;;</div><div class="line">int main(int argc, char *argv[])</div><div class="line">&#123;</div><div class="line"> int opt=0;</div><div class="line"> int options_index=0;</div><div class="line"> char *tmp=NULL;</div><div class="line">//错误</div><div class="line"> if(argc==1)</div><div class="line"> &#123;</div><div class="line"> usage();</div><div class="line">          return 2;</div><div class="line"> &#125;</div><div class="line"></div><div class="line"> while((opt=getopt_long(argc,argv,&quot;912Vfrt:p:c:?h&quot;,long_options,&amp;options_index))!=EOF )</div><div class="line"> &#123;</div><div class="line">  switch(opt)</div><div class="line">  &#123; //输入参数</div><div class="line">   case  0 : break;</div><div class="line">   case &apos;f&apos;: force=1;break;</div><div class="line">   case &apos;r&apos;: force_reload=1;break;</div><div class="line">   case &apos;9&apos;: http10=0;break;</div><div class="line">   case &apos;1&apos;: http10=1;break;</div><div class="line">   case &apos;2&apos;: http10=2;break;</div><div class="line">   case &apos;V&apos;: printf(PROGRAM_VERSION&quot;\n&quot;);exit(0); //输入版本号</div><div class="line">   case &apos;t&apos;: benchtime=atoi(optarg);break;	     //命令后的参数，atoi字符转换长整型</div><div class="line">   case &apos;p&apos;:</div><div class="line">    /* proxy server parsing server:port */</div><div class="line">    tmp=strrchr(optarg,&apos;:&apos;);</div><div class="line">    proxyhost=optarg; //设定地址</div><div class="line">    if(tmp==NULL)</div><div class="line">    &#123;</div><div class="line">    break;</div><div class="line">    &#125;</div><div class="line">    if(tmp==optarg)</div><div class="line">    &#123;</div><div class="line">    fprintf(stderr,&quot;Error in option --proxy %s: Missing hostname.\n&quot;,optarg);</div><div class="line">    return 2;</div><div class="line">    &#125;</div><div class="line">    if(tmp==optarg+strlen(optarg)-1)</div><div class="line">    &#123;</div><div class="line">    fprintf(stderr,&quot;Error in option --proxy %s Port number is missing.\n&quot;,optarg);</div><div class="line">    return 2;</div><div class="line">    &#125;</div><div class="line">    *tmp=&apos;\0&apos;;</div><div class="line">    proxyport=atoi(tmp+1);break;</div><div class="line">   case &apos;:&apos;:</div><div class="line">   case &apos;h&apos;:</div><div class="line">   case &apos;?&apos;: usage();return 2;break;</div><div class="line">   case &apos;c&apos;: clients=atoi(optarg);break;</div><div class="line">  &#125;</div><div class="line"> &#125;</div><div class="line"> //optind参数下标</div><div class="line"> if(optind==argc) &#123;</div><div class="line">                      fprintf(stderr,&quot;webbench: Missing URL!\n&quot;);</div><div class="line">     usage();</div><div class="line">     return 2;</div><div class="line">                    &#125;</div><div class="line"></div><div class="line"> if(clients==0) clients=1;</div><div class="line"> if(benchtime==0) benchtime=60;</div><div class="line"> /* Copyright */</div><div class="line"> fprintf(stderr,&quot;Webbench - Simple Web Benchmark &quot;PROGRAM_VERSION&quot;\n&quot;</div><div class="line">&quot;Copyright (c) Radim Kolar 1997-2004, GPL Open Source Software.\n&quot;</div><div class="line">);</div><div class="line">//optind为URL位置</div><div class="line"> build_request(argv[optind]);</div><div class="line"> /* print bench info */</div><div class="line"> printf(&quot;\nBenchmarking: &quot;);</div><div class="line"> switch(method)</div><div class="line"> &#123;</div><div class="line">case METHOD_GET:</div><div class="line">default:</div><div class="line">printf(&quot;GET&quot;);break;</div><div class="line">case METHOD_OPTIONS:</div><div class="line">printf(&quot;OPTIONS&quot;);break;</div><div class="line">case METHOD_HEAD:</div><div class="line">printf(&quot;HEAD&quot;);break;</div><div class="line">case METHOD_TRACE:</div><div class="line">printf(&quot;TRACE&quot;);break;</div><div class="line"> &#125;</div><div class="line"> printf(&quot; %s&quot;,argv[optind]);</div><div class="line"> switch(http10)</div><div class="line"> &#123;</div><div class="line">case 0: printf(&quot; (using HTTP/0.9)&quot;);break;</div><div class="line">case 2: printf(&quot; (using HTTP/1.1)&quot;);break;</div><div class="line"> &#125;</div><div class="line"> printf(&quot;\n&quot;);</div><div class="line"> if(clients==1) printf(&quot;1 client&quot;);</div><div class="line"> else</div><div class="line">   printf(&quot;%d clients&quot;,clients);</div><div class="line"></div><div class="line"> printf(&quot;, running %d sec&quot;, benchtime);</div><div class="line"> if(force) printf(&quot;, early socket close&quot;);</div><div class="line"> if(proxyhost!=NULL) printf(&quot;, via proxy server %s:%d&quot;,proxyhost,proxyport);</div><div class="line"> if(force_reload) printf(&quot;, forcing reload&quot;);</div><div class="line"> printf(&quot;.\n&quot;);</div><div class="line"> return bench();</div><div class="line">&#125;</div><div class="line">//创建URL请求连接</div><div class="line">void build_request(const char *url)</div><div class="line">&#123;</div><div class="line">  char tmp[10];</div><div class="line">  int i;</div><div class="line">//请求地址和连接清零</div><div class="line">  bzero(host,MAXHOSTNAMELEN);</div><div class="line">  bzero(request,REQUEST_SIZE);</div><div class="line"></div><div class="line">  if(force_reload &amp;&amp; proxyhost!=NULL &amp;&amp; http10&lt;1) http10=1;</div><div class="line">  if(method==METHOD_HEAD &amp;&amp; http10&lt;1) http10=1;</div><div class="line">  if(method==METHOD_OPTIONS &amp;&amp; http10&lt;2) http10=2;</div><div class="line">  if(method==METHOD_TRACE &amp;&amp; http10&lt;2) http10=2;</div><div class="line"></div><div class="line">  switch(method)</div><div class="line">  &#123;</div><div class="line"> default:</div><div class="line"> case METHOD_GET: strcpy(request,&quot;GET&quot;);break;</div><div class="line"> case METHOD_HEAD: strcpy(request,&quot;HEAD&quot;);break;</div><div class="line"> case METHOD_OPTIONS: strcpy(request,&quot;OPTIONS&quot;);break;</div><div class="line"> case METHOD_TRACE: strcpy(request,&quot;TRACE&quot;);break;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  strcat(request,&quot; &quot;);</div><div class="line"></div><div class="line">  if(NULL==strstr(url,&quot;://&quot;))</div><div class="line">  &#123;</div><div class="line"> fprintf(stderr, &quot;\n%s: is not a valid URL.\n&quot;,url);</div><div class="line"> exit(2);</div><div class="line">  &#125;</div><div class="line">  if(strlen(url)&gt;1500) //太长出错</div><div class="line">  &#123;</div><div class="line">         fprintf(stderr,&quot;URL is too long.\n&quot;);</div><div class="line">exit(2);</div><div class="line">  &#125;</div><div class="line">  if(proxyhost==NULL) //代理服务器为空</div><div class="line">  if (0!=strncasecmp(&quot;http://&quot;,url,7))</div><div class="line">  &#123; fprintf(stderr,&quot;\nOnly HTTP protocol is directly supported, set --proxy for others.\n&quot;);</div><div class="line">             exit(2);</div><div class="line">           &#125;</div><div class="line">  /* protocol/host delimiter */</div><div class="line">  i=strstr(url,&quot;://&quot;)-url+3; //i指向有用地址</div><div class="line">  /* printf(&quot;%d\n&quot;,i); */</div><div class="line"></div><div class="line">  if(strchr(url+i,&apos;/&apos;)==NULL) &#123;</div><div class="line">                                fprintf(stderr,&quot;\nInvalid URL syntax - hostname don&apos;t ends with &apos;/&apos;.\n&quot;);</div><div class="line">                                exit(2);</div><div class="line">                              &#125;</div><div class="line">  if(proxyhost==NULL)</div><div class="line">  &#123;</div><div class="line">   /* get port from hostname */</div><div class="line">   if(index(url+i,&apos;:&apos;)!=NULL &amp;&amp;</div><div class="line">      index(url+i,&apos;:&apos;)&lt;index(url+i,&apos;/&apos;))</div><div class="line">   &#123;</div><div class="line">  strncpy(host,url+i,strchr(url+i,&apos;:&apos;)-url-i); //取出主机地址</div><div class="line">  bzero(tmp,10);</div><div class="line">  strncpy(tmp,index(url+i,&apos;:&apos;)+1,strchr(url+i,&apos;/&apos;)-index(url+i,&apos;:&apos;)-1);</div><div class="line">  /* printf(&quot;tmp=%s\n&quot;,tmp); */</div><div class="line">  proxyport=atoi(tmp);</div><div class="line">  if(proxyport==0) proxyport=80;</div><div class="line">   &#125; else</div><div class="line">   &#123;</div><div class="line">     strncpy(host,url+i,strcspn(url+i,&quot;/&quot;));</div><div class="line">   &#125;</div><div class="line">   // printf(&quot;Host=%s\n&quot;,host);</div><div class="line">   strcat(request+strlen(request),url+i+strcspn(url+i,&quot;/&quot;));</div><div class="line">  &#125; else</div><div class="line">  &#123;</div><div class="line">   // printf(&quot;ProxyHost=%s\nProxyPort=%d\n&quot;,proxyhost,proxyport);</div><div class="line">   strcat(request,url);</div><div class="line">  &#125;</div><div class="line">  if(http10==1)</div><div class="line"> strcat(request,&quot; HTTP/1.0&quot;);</div><div class="line">  else if (http10==2)</div><div class="line"> strcat(request,&quot; HTTP/1.1&quot;);</div><div class="line">  strcat(request,&quot;\r\n&quot;);</div><div class="line">  if(http10&gt;0)</div><div class="line"> strcat(request,&quot;User-Agent: WebBench &quot;PROGRAM_VERSION&quot;\r\n&quot;);</div><div class="line">  if(proxyhost==NULL &amp;&amp; http10&gt;0)</div><div class="line">  &#123;</div><div class="line"> strcat(request,&quot;Host: &quot;);</div><div class="line"> strcat(request,host);</div><div class="line"> strcat(request,&quot;\r\n&quot;);</div><div class="line">  &#125;</div><div class="line">  if(force_reload &amp;&amp; proxyhost!=NULL)</div><div class="line">  &#123;</div><div class="line"> strcat(request,&quot;Pragma: no-cache\r\n&quot;);</div><div class="line">  &#125;</div><div class="line">  if(http10&gt;1)</div><div class="line"> strcat(request,&quot;Connection: close\r\n&quot;);</div><div class="line">  /* add empty line at end */</div><div class="line">  if(http10&gt;0) strcat(request,&quot;\r\n&quot;);</div><div class="line">  // printf(&quot;Req=%s\n&quot;,request);</div><div class="line">&#125;</div><div class="line"></div><div class="line">/* vraci system rc error kod */</div><div class="line">//创建管道和子进程，进行测试</div><div class="line">static int bench(void)</div><div class="line">&#123;</div><div class="line">  int i,j,k;</div><div class="line">  pid_t pid=0;</div><div class="line">  FILE *f;</div><div class="line"></div><div class="line">  /* check avaibility of target server */</div><div class="line">  i=Socket(proxyhost==NULL?host:proxyhost,proxyport);</div><div class="line">  if(i&lt;0) &#123;</div><div class="line">  fprintf(stderr,&quot;\nConnect to server failed. Aborting benchmark.\n&quot;);</div><div class="line">           return 1;</div><div class="line">         &#125;</div><div class="line">  close(i);</div><div class="line">  /* create pipe */</div><div class="line">  if(pipe(mypipe))</div><div class="line">  &#123;</div><div class="line"> perror(&quot;pipe failed.&quot;);</div><div class="line"> return 3;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  /* not needed, since we have alarm() in childrens */</div><div class="line">  /* wait 4 next system clock tick */</div><div class="line">  /*</div><div class="line">  cas=time(NULL);</div><div class="line">  while(time(NULL)==cas)</div><div class="line">        sched_yield();</div><div class="line">  */</div><div class="line"></div><div class="line">  /* fork childs */</div><div class="line">  for(i=0;i&lt;clients;i++)</div><div class="line">  &#123;</div><div class="line">  pid=fork();</div><div class="line">  if(pid &lt;= (pid_t) 0)</div><div class="line">  &#123;</div><div class="line">  /* child process or error*/</div><div class="line">          sleep(1); /* make childs faster */</div><div class="line">  break;</div><div class="line">  &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  if( pid&lt; (pid_t) 0)</div><div class="line">  &#123;</div><div class="line">          fprintf(stderr,&quot;problems forking worker no. %d\n&quot;,i);</div><div class="line"> perror(&quot;fork failed.&quot;);</div><div class="line"> return 3;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  if(pid== (pid_t) 0)</div><div class="line">  &#123;</div><div class="line">    /* I am a child */</div><div class="line">    if(proxyhost==NULL)</div><div class="line">      benchcore(host,proxyport,request);</div><div class="line">         else</div><div class="line">      benchcore(proxyhost,proxyport,request);</div><div class="line"></div><div class="line">         /* write results to pipe */</div><div class="line">f=fdopen(mypipe[1],&quot;w&quot;);</div><div class="line">if(f==NULL)</div><div class="line">&#123;</div><div class="line">perror(&quot;open pipe for writing failed.&quot;);</div><div class="line">return 3;</div><div class="line">&#125;</div><div class="line">/* fprintf(stderr,&quot;Child - %d %d\n&quot;,speed,failed); */</div><div class="line">fprintf(f,&quot;%d %d %d\n&quot;,speed,failed,bytes); //把每个子进程放到管道</div><div class="line">fclose(f);</div><div class="line">return 0;</div><div class="line">  &#125; else</div><div class="line">  &#123;</div><div class="line"> f=fdopen(mypipe[0],&quot;r&quot;);</div><div class="line"> if(f==NULL)</div><div class="line"> &#123;</div><div class="line"> perror(&quot;open pipe for reading failed.&quot;);</div><div class="line"> return 3;</div><div class="line"> &#125;</div><div class="line"> setvbuf(f,NULL,_IONBF,0);</div><div class="line"> speed=0;</div><div class="line">          failed=0;</div><div class="line">          bytes=0;</div><div class="line"></div><div class="line"> while(1)</div><div class="line">//父进程读取管道数据，并做加法</div><div class="line"> &#123;</div><div class="line"> pid=fscanf(f,&quot;%d %d %d&quot;,&amp;i,&amp;j,&amp;k);</div><div class="line"> if(pid&lt;2)</div><div class="line">                  &#123;</div><div class="line">                       fprintf(stderr,&quot;Some of our childrens died.\n&quot;);</div><div class="line">                       break;</div><div class="line">                  &#125;</div><div class="line"> speed+=i;</div><div class="line"> failed+=j;</div><div class="line"> bytes+=k;</div><div class="line"> /* fprintf(stderr,&quot;*Knock* %d %d read=%d\n&quot;,speed,failed,pid); */</div><div class="line"> if(--clients==0) break;</div><div class="line"> &#125;</div><div class="line"> fclose(f);</div><div class="line">//输出结果</div><div class="line">  printf(&quot;\nSpeed=%d pages/min, %d bytes/sec.\nRequests: %d susceed, %d failed.\n&quot;,</div><div class="line"> (int)((speed+failed)/(benchtime/60.0f)),</div><div class="line"> (int)(bytes/(float)benchtime),</div><div class="line"> speed,</div><div class="line"> failed);</div><div class="line">  &#125;</div><div class="line">  return i;</div><div class="line">&#125;</div><div class="line"></div><div class="line">void benchcore(const char *host,const int port,const char *req)</div><div class="line">&#123;</div><div class="line"> int rlen;</div><div class="line"> char buf[1500];</div><div class="line"> int s,i;</div><div class="line"> struct sigaction sa;</div><div class="line"></div><div class="line"> /* setup alarm signal handler */</div><div class="line"> sa.sa_handler=alarm_handler; //定时器方法</div><div class="line"> sa.sa_flags=0;</div><div class="line"> if(sigaction(SIGALRM,&amp;sa,NULL))</div><div class="line">    exit(3);</div><div class="line"> alarm(benchtime);</div><div class="line"></div><div class="line"> rlen=strlen(req);</div><div class="line"> nexttry:while(1)</div><div class="line"> &#123;</div><div class="line">    if(timer expired)//超时</div><div class="line">    &#123;</div><div class="line">       if(failed&gt;0)</div><div class="line">       &#123;</div><div class="line">          /* fprintf(stderr,&quot;Correcting failed by signal\n&quot;); */</div><div class="line">          failed--;</div><div class="line">       &#125;</div><div class="line">       return;</div><div class="line">    &#125;</div><div class="line">    s=Socket(host,port);      //创建链接                    </div><div class="line">    if(s&lt;0) &#123; failed++;continue;&#125; //连接失败</div><div class="line">    if(rlen!=write(s,req,rlen)) &#123;failed++;close(s);continue;&#125;</div><div class="line">    if(http10==0)</div><div class="line">   if(shutdown(s,1)) &#123; failed++;close(s);continue;&#125;//发送失败</div><div class="line">    if(force==0) //读取http请求数据</div><div class="line">    &#123;</div><div class="line">            /* read all available data from socket */</div><div class="line">   while(1)</div><div class="line">   &#123;</div><div class="line">              if(timerexpired) break;</div><div class="line">     i=read(s,buf,1500);</div><div class="line">              /* fprintf(stderr,&quot;%d\n&quot;,i); */</div><div class="line">     if(i&lt;0)</div><div class="line">              &#123;</div><div class="line">                 failed++;</div><div class="line">                 close(s);</div><div class="line">                 goto nexttry;</div><div class="line">              &#125;</div><div class="line">      else</div><div class="line">      if(i==0) break;</div><div class="line">      else</div><div class="line">      bytes+=i;</div><div class="line">   &#125;</div><div class="line">    &#125;</div><div class="line">    if(close(s)) &#123;failed++;continue;&#125;</div><div class="line">    speed++; //测试成功</div><div class="line"> &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>参考<br><a href="http://www.cnblogs.com/xuning/p/3888699.html" target="_blank" rel="external">http://www.cnblogs.com/xuning/p/3888699.html</a></p>
<p>接下来说一说TinyHttpd~</p>
<p><strong>TinyHttpd</strong><br><a href="https://sourceforge.net/projects/tinyhttpd/files/latest/download" target="_blank" rel="external">https://sourceforge.net/projects/tinyhttpd/files/latest/download</a></p>
<p>源码在此  <em>tinyhttpd-0.1.0.tar.gz</em></p>
<p><strong>编译运行</strong><br>步骤如下<br>1.在网站上下载源代码</p>
<p><code>wget http://jaist.dl.sourceforge.net/project/tinyhttpd/tinyhttpd%20source/tinyhttpd%200.1.0/tinyhttpd-0.1.0.tar.gz</code></p>
<p><img src="http://img.blog.csdn.net/20160727223156889" alt="这里写图片描述"></p>
<p>2.解压</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tar  zxvf tinyhttpd-0.1.0.tar.gz</div></pre></td></tr></table></figure>
<p><img src="http://img.blog.csdn.net/20160730210123873" alt="这里写图片描述"></p>
<p>3.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cd tinyhttpd-0.1.0</div></pre></td></tr></table></figure></p>
<p>4.make文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">make</div></pre></td></tr></table></figure>
<p><strong>高能出现错误！</strong></p>
<p><img src="http://img.blog.csdn.net/20160730210257235" alt="这里写图片描述"></p>
<p><img src="http://img.blog.csdn.net/20160730210313016" alt="这里写图片描述"></p>
<p><strong>原因分析！</strong></p>
<p>TinyHttpd本来是在solaris上实现的，在socket和pthread的实现上和一般的Linux不一样。httpd.c开始的英文注释做出了对程序修改的详细指引</p>
<p><strong>故（1）修改httpd.c</strong>根据开头注释</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div><div class="line">352</div><div class="line">353</div><div class="line">354</div><div class="line">355</div><div class="line">356</div><div class="line">357</div><div class="line">358</div><div class="line">359</div><div class="line">360</div><div class="line">361</div><div class="line">362</div><div class="line">363</div><div class="line">364</div><div class="line">365</div><div class="line">366</div><div class="line">367</div><div class="line">368</div><div class="line">369</div><div class="line">370</div><div class="line">371</div><div class="line">372</div><div class="line">373</div><div class="line">374</div><div class="line">375</div><div class="line">376</div><div class="line">377</div><div class="line">378</div><div class="line">379</div><div class="line">380</div><div class="line">381</div><div class="line">382</div><div class="line">383</div><div class="line">384</div><div class="line">385</div><div class="line">386</div><div class="line">387</div><div class="line">388</div><div class="line">389</div><div class="line">390</div><div class="line">391</div><div class="line">392</div><div class="line">393</div><div class="line">394</div><div class="line">395</div><div class="line">396</div><div class="line">397</div><div class="line">398</div><div class="line">399</div><div class="line">400</div><div class="line">401</div><div class="line">402</div><div class="line">403</div><div class="line">404</div><div class="line">405</div><div class="line">406</div><div class="line">407</div><div class="line">408</div><div class="line">409</div><div class="line">410</div><div class="line">411</div><div class="line">412</div><div class="line">413</div><div class="line">414</div><div class="line">415</div><div class="line">416</div><div class="line">417</div><div class="line">418</div><div class="line">419</div><div class="line">420</div><div class="line">421</div><div class="line">422</div><div class="line">423</div><div class="line">424</div><div class="line">425</div><div class="line">426</div><div class="line">427</div><div class="line">428</div><div class="line">429</div><div class="line">430</div><div class="line">431</div><div class="line">432</div><div class="line">433</div><div class="line">434</div><div class="line">435</div><div class="line">436</div><div class="line">437</div><div class="line">438</div><div class="line">439</div><div class="line">440</div><div class="line">441</div><div class="line">442</div><div class="line">443</div><div class="line">444</div><div class="line">445</div><div class="line">446</div><div class="line">447</div><div class="line">448</div><div class="line">449</div><div class="line">450</div><div class="line">451</div><div class="line">452</div><div class="line">453</div><div class="line">454</div><div class="line">455</div><div class="line">456</div><div class="line">457</div><div class="line">458</div><div class="line">459</div><div class="line">460</div><div class="line">461</div><div class="line">462</div><div class="line">463</div><div class="line">464</div><div class="line">465</div><div class="line">466</div><div class="line">467</div><div class="line">468</div><div class="line">469</div><div class="line">470</div><div class="line">471</div><div class="line">472</div><div class="line">473</div><div class="line">474</div><div class="line">475</div><div class="line">476</div><div class="line">477</div><div class="line">478</div><div class="line">479</div><div class="line">480</div><div class="line">481</div><div class="line">482</div><div class="line">483</div><div class="line">484</div><div class="line">485</div><div class="line">486</div><div class="line">487</div><div class="line">488</div><div class="line">489</div><div class="line">490</div><div class="line">491</div><div class="line">492</div><div class="line">493</div><div class="line">494</div><div class="line">495</div><div class="line">496</div><div class="line">497</div><div class="line">498</div><div class="line">499</div><div class="line">500</div><div class="line">501</div><div class="line">502</div><div class="line">503</div><div class="line">504</div><div class="line">505</div><div class="line">506</div><div class="line">507</div><div class="line">508</div><div class="line">509</div><div class="line">510</div><div class="line">511</div><div class="line">512</div><div class="line">513</div><div class="line">514</div><div class="line">515</div><div class="line">516</div><div class="line">517</div></pre></td><td class="code"><pre><div class="line">httpd.c</div><div class="line"></div><div class="line">/* J. David&apos;s webserver */</div><div class="line">/* This is a simple webserver.</div><div class="line"> * Created November 1999 by J. David Blackstone.</div><div class="line"> * CSE 4344 (Network concepts), Prof. Zeigler</div><div class="line"> * University of Texas at Arlington</div><div class="line"> */</div><div class="line">/* This program compiles for Sparc Solaris 2.6.</div><div class="line"> * To compile for Linux:</div><div class="line"> *  1) Comment out the #include &lt;pthread.h&gt; line.</div><div class="line"> *  2) Comment out the line that defines the variable newthread.</div><div class="line"> *  3) Comment out the two lines that run pthread_create().</div><div class="line"> *  4) Uncomment the line that runs accept_request().</div><div class="line"> *  5) Remove -lsocket from the Makefile.</div><div class="line"> */</div><div class="line">#include &lt;stdio.h&gt;</div><div class="line">#include &lt;sys/socket.h&gt;</div><div class="line">#include &lt;sys/types.h&gt;</div><div class="line">#include &lt;netinet/in.h&gt;</div><div class="line">#include &lt;arpa/inet.h&gt;</div><div class="line">#include &lt;unistd.h&gt;</div><div class="line">#include &lt;ctype.h&gt;</div><div class="line">#include &lt;strings.h&gt;</div><div class="line">#include &lt;string.h&gt;</div><div class="line">#include &lt;sys/stat.h&gt;</div><div class="line">#include &lt;pthread.h&gt;</div><div class="line">#include &lt;sys/wait.h&gt;</div><div class="line">#include &lt;stdlib.h&gt;</div><div class="line"></div><div class="line">#define ISspace(x) isspace((int)(x))</div><div class="line"></div><div class="line">#define SERVER_STRING &quot;Server: jdbhttpd/0.1.0\r\n&quot;</div><div class="line"></div><div class="line">void *accept_request(void *);</div><div class="line">void bad_request(int);</div><div class="line">void cat(int, FILE *);</div><div class="line">void cannot_execute(int);</div><div class="line">void error_die(const char *);</div><div class="line">void execute_cgi(int, const char *, const char *, const char *);</div><div class="line">int get_line(int, char *, int);</div><div class="line">void headers(int, const char *);</div><div class="line">void not_found(int);</div><div class="line">void serve_file(int, const char *);</div><div class="line">int startup(u_short *);</div><div class="line">void unimplemented(int);</div><div class="line"></div><div class="line">/**********************************************************************/</div><div class="line">/* A request has caused a call to accept() on the server port to</div><div class="line"> * return.  Process the request appropriately.</div><div class="line"> * Parameters: the socket connected to the client */</div><div class="line">/**********************************************************************/</div><div class="line">void *accept_request(void * tclient)</div><div class="line">&#123;</div><div class="line"> int client = *(int *)tclient;</div><div class="line"> char buf[1024];</div><div class="line"> int numchars;</div><div class="line"> char method[255];</div><div class="line"> char url[255];</div><div class="line"> char path[512];</div><div class="line"> size_t i, j;</div><div class="line"> struct stat st;</div><div class="line"> int cgi = 0;      /* becomes true if server decides this is a CGI</div><div class="line">                    * program */</div><div class="line"> char *query_string = NULL;</div><div class="line">//得到请求第一行</div><div class="line"> numchars = get_line(client, buf, sizeof(buf));</div><div class="line"> i = 0; j = 0;</div><div class="line">//客户端请求方法存到数组</div><div class="line"> while (!ISspace(buf[j]) &amp;&amp; (i &lt; sizeof(method) - 1))</div><div class="line"> &#123;</div><div class="line">  method[i] = buf[j];</div><div class="line">  i++; j++;</div><div class="line"> &#125;</div><div class="line"> method[i] = &apos;\0&apos;;</div><div class="line"></div><div class="line"> if (strcasecmp(method, &quot;GET&quot;) &amp;&amp; strcasecmp(method, &quot;POST&quot;))</div><div class="line"> &#123;</div><div class="line">  unimplemented(client);</div><div class="line">  return NULL;</div><div class="line"> &#125;//出错</div><div class="line">//post开启cgi</div><div class="line"> if (strcasecmp(method, &quot;POST&quot;) == 0)</div><div class="line">  cgi = 1;</div><div class="line">//读取url地址</div><div class="line"> i = 0;</div><div class="line"> while (ISspace(buf[j]) &amp;&amp; (j &lt; sizeof(buf)))</div><div class="line">  j++;</div><div class="line"> while (!ISspace(buf[j]) &amp;&amp; (i &lt; sizeof(url) - 1) &amp;&amp; (j &lt; sizeof(buf)))</div><div class="line"> &#123;</div><div class="line">  url[i] = buf[j];</div><div class="line">  i++; j++;</div><div class="line"> &#125;</div><div class="line"> url[i] = &apos;\0&apos;;</div><div class="line"></div><div class="line"> if (strcasecmp(method, &quot;GET&quot;) == 0)</div><div class="line"> &#123;//待处理请求为url</div><div class="line">  query_string = url;</div><div class="line">  while ((*query_string != &apos;?&apos;) &amp;&amp; (*query_string != &apos;\0&apos;))</div><div class="line">   query_string++;</div><div class="line">  if (*query_string == &apos;?&apos;)</div><div class="line">  &#123;</div><div class="line">   cgi = 1;</div><div class="line">   *query_string = &apos;\0&apos;;</div><div class="line">   query_string++;</div><div class="line">  &#125;</div><div class="line"> &#125;</div><div class="line">//格式化url到path数组</div><div class="line"> sprintf(path, &quot;htdocs%s&quot;, url);</div><div class="line"> if (path[strlen(path) - 1] == &apos;/&apos;)</div><div class="line">  strcat(path, &quot;index.html”); //默认</div><div class="line"> if (stat(path, &amp;st) == -1) &#123; //路径找文件</div><div class="line">  while ((numchars &gt; 0) &amp;&amp; strcmp(&quot;\n&quot;, buf))  /* read &amp; discard headers */</div><div class="line">   numchars = get_line(client, buf, sizeof(buf));</div><div class="line">  not_found(client); //找不到</div><div class="line"> &#125;</div><div class="line"> else</div><div class="line"> &#123;//目录 默认index</div><div class="line">  if ((st.st_mode &amp; S_IFMT) == S_IFDIR)</div><div class="line">   strcat(path, &quot;/index.html&quot;);</div><div class="line">  if ((st.st_mode &amp; S_IXUSR) ||</div><div class="line">      (st.st_mode &amp; S_IXGRP) ||</div><div class="line">      (st.st_mode &amp; S_IXOTH)    )</div><div class="line">   cgi = 1;</div><div class="line">  if (!cgi) //非cgi，返回服务器文件</div><div class="line">   serve_file(client, path);</div><div class="line">  else</div><div class="line">   execute_cgi(client, path, method, query_string);</div><div class="line"> &#125;</div><div class="line">//断开</div><div class="line"> close(client);</div><div class="line"> return NULL;</div><div class="line">&#125;</div><div class="line"></div><div class="line">/**********************************************************************/</div><div class="line">/* Inform the client that a request it has made has a problem.</div><div class="line"> * Parameters: client socket */</div><div class="line">/**********************************************************************/</div><div class="line">void bad_request(int client)</div><div class="line">&#123;</div><div class="line"> char buf[1024];</div><div class="line">//错误请求</div><div class="line"> sprintf(buf, &quot;HTTP/1.0 400 BAD REQUEST\r\n&quot;);</div><div class="line"> send(client, buf, sizeof(buf), 0);</div><div class="line"> sprintf(buf, &quot;Content-type: text/html\r\n&quot;);</div><div class="line"> send(client, buf, sizeof(buf), 0);</div><div class="line"> sprintf(buf, &quot;\r\n&quot;);</div><div class="line"> send(client, buf, sizeof(buf), 0);</div><div class="line"> sprintf(buf, &quot;&lt;P&gt;Your browser sent a bad request, &quot;);</div><div class="line"> send(client, buf, sizeof(buf), 0);</div><div class="line"> sprintf(buf, &quot;such as a POST without a Content-Length.\r\n&quot;);</div><div class="line"> send(client, buf, sizeof(buf), 0);</div><div class="line">&#125;</div><div class="line"></div><div class="line">/**********************************************************************/</div><div class="line">/* Put the entire contents of a file out on a socket.  This function</div><div class="line"> * is named after the UNIX &quot;cat&quot; command, because it might have been</div><div class="line"> * easier just to do something like pipe, fork, and exec(&quot;cat&quot;).</div><div class="line"> * Parameters: the client socket descriptor</div><div class="line"> *             FILE pointer for the file to cat */</div><div class="line">/**********************************************************************/</div><div class="line">void cat(int client, FILE *resource)</div><div class="line">&#123;</div><div class="line"> char buf[1024];</div><div class="line">//读数据到socket</div><div class="line"> fgets(buf, sizeof(buf), resource);</div><div class="line"> while (!feof(resource))</div><div class="line"> &#123;</div><div class="line">  send(client, buf, strlen(buf), 0);</div><div class="line">  fgets(buf, sizeof(buf), resource);</div><div class="line"> &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">/**********************************************************************/</div><div class="line">/* Inform the client that a CGI script could not be executed.</div><div class="line"> * Parameter: the client socket descriptor. */</div><div class="line">/**********************************************************************/</div><div class="line">void cannot_execute(int client)</div><div class="line">&#123;</div><div class="line"> char buf[1024];</div><div class="line">//无法执行</div><div class="line"> sprintf(buf, &quot;HTTP/1.0 500 Internal Server Error\r\n&quot;);</div><div class="line"> send(client, buf, strlen(buf), 0);</div><div class="line"> sprintf(buf, &quot;Content-type: text/html\r\n&quot;);</div><div class="line"> send(client, buf, strlen(buf), 0);</div><div class="line"> sprintf(buf, &quot;\r\n&quot;);</div><div class="line"> send(client, buf, strlen(buf), 0);</div><div class="line"> sprintf(buf, &quot;&lt;P&gt;Error prohibited CGI execution.\r\n&quot;);</div><div class="line"> send(client, buf, strlen(buf), 0);</div><div class="line">&#125;</div><div class="line"></div><div class="line">/**********************************************************************/</div><div class="line">/* Print out an error message with perror() (for system errors; based</div><div class="line"> * on value of errno, which indicates system call errors) and exit the</div><div class="line"> * program indicating an error. */</div><div class="line">/**********************************************************************/</div><div class="line">void error_die(const char *sc)</div><div class="line">&#123;</div><div class="line"> perror(sc);</div><div class="line"> exit(1);</div><div class="line">&#125;</div><div class="line"></div><div class="line">/**********************************************************************/</div><div class="line">/* Execute a CGI script.  Will need to set environment variables as</div><div class="line"> * appropriate.</div><div class="line"> * Parameters: client socket descriptor</div><div class="line"> *             path to the CGI script */</div><div class="line">/**********************************************************************/</div><div class="line">void execute_cgi(int client, const char *path,</div><div class="line">                 const char *method, const char *query_string)</div><div class="line">&#123;</div><div class="line"> char buf[1024];</div><div class="line"> int cgi_output[2];</div><div class="line"> int cgi_input[2];</div><div class="line"> pid_t pid;</div><div class="line"> int status;</div><div class="line"> int i;</div><div class="line"> char c;</div><div class="line"> int numchars = 1;</div><div class="line"> int content_length = -1;</div><div class="line">//所有http首部读取丢弃</div><div class="line"> buf[0] = &apos;A&apos;; buf[1] = &apos;\0&apos;;</div><div class="line"> if (strcasecmp(method, &quot;GET&quot;) == 0)</div><div class="line">  while ((numchars &gt; 0) &amp;&amp; strcmp(&quot;\n&quot;, buf))  /* read &amp; discard headers */</div><div class="line">   numchars = get_line(client, buf, sizeof(buf));</div><div class="line"> else    /* POST */</div><div class="line"> &#123;//在post的http请求中找出cotent_length</div><div class="line">  numchars = get_line(client, buf, sizeof(buf));</div><div class="line">  while ((numchars &gt; 0) &amp;&amp; strcmp(&quot;\n&quot;, buf))</div><div class="line">  &#123;</div><div class="line">   buf[15] = &apos;\0&apos;;</div><div class="line">   if (strcasecmp(buf, &quot;Content-Length:&quot;) == 0)</div><div class="line">    content_length = atoi(&amp;(buf[16]));</div><div class="line">   numchars = get_line(client, buf, sizeof(buf));</div><div class="line">  &#125;//没找到</div><div class="line">  if (content_length == -1) &#123;</div><div class="line">   bad_request(client);</div><div class="line">   return;</div><div class="line">  &#125;</div><div class="line"> &#125;</div><div class="line">//http状态码200</div><div class="line"> sprintf(buf, &quot;HTTP/1.0 200 OK\r\n&quot;);</div><div class="line"> send(client, buf, strlen(buf), 0);</div><div class="line">//建立管道，错误</div><div class="line"> if (pipe(cgi_output) &lt; 0) &#123;</div><div class="line">  cannot_execute(client);</div><div class="line">  return;</div><div class="line"> &#125;</div><div class="line"> if (pipe(cgi_input) &lt; 0) &#123;</div><div class="line">  cannot_execute(client);</div><div class="line">  return;</div><div class="line"> &#125;</div><div class="line"></div><div class="line"> if ( (pid = fork()) &lt; 0 ) &#123;</div><div class="line">  cannot_execute(client);</div><div class="line">  return;</div><div class="line"> &#125;</div><div class="line"> if (pid == 0)  /* child: CGI script */</div><div class="line"> &#123;</div><div class="line">  char meth_env[255];</div><div class="line">  char query_env[255];</div><div class="line">  char length_env[255];</div><div class="line">//把stdout重定向到写入端</div><div class="line">  dup2(cgi_output[1], 1);</div><div class="line">//stdin同理</div><div class="line">  dup2(cgi_input[0], 0);</div><div class="line">  close(cgi_output[0]);</div><div class="line">  close(cgi_input[1]);</div><div class="line">//设置环境变量</div><div class="line">  sprintf(meth_env, &quot;REQUEST_METHOD=%s&quot;, method);</div><div class="line">  putenv(meth_env);</div><div class="line">  if (strcasecmp(method, &quot;GET&quot;) == 0) &#123;</div><div class="line">//设置环境变量</div><div class="line">   sprintf(query_env, &quot;QUERY_STRING=%s&quot;, query_string);</div><div class="line">   putenv(query_env);</div><div class="line">  &#125;</div><div class="line">  else &#123;   /* POST */</div><div class="line">   sprintf(length_env, &quot;CONTENT_LENGTH=%d&quot;, content_length);</div><div class="line">   putenv(length_env);</div><div class="line">  &#125;</div><div class="line">//运行cgi程序</div><div class="line">  execl(path, path, NULL);</div><div class="line">  exit(0);</div><div class="line"> &#125; else &#123;    /* parent */</div><div class="line">  close(cgi_output[1]);</div><div class="line">  close(cgi_input[0]);</div><div class="line">  if (strcasecmp(method, &quot;POST&quot;) == 0)</div><div class="line">//接收post数据</div><div class="line">   for (i = 0; i &lt; content_length; i++) &#123;</div><div class="line">    recv(client, &amp;c, 1, 0);</div><div class="line">//把post数据写入</div><div class="line">    write(cgi_input[1], &amp;c, 1);</div><div class="line">   &#125;//读取管道输出到客户端</div><div class="line">  while (read(cgi_output[0], &amp;c, 1) &gt; 0)</div><div class="line">   send(client, &amp;c, 1, 0);</div><div class="line"></div><div class="line">  close(cgi_output[0]);</div><div class="line">  close(cgi_input[1]);</div><div class="line">//等待子程序</div><div class="line">  waitpid(pid, &amp;status, 0);</div><div class="line"> &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">/**********************************************************************/</div><div class="line">/* Get a line from a socket, whether the line ends in a newline,</div><div class="line"> * carriage return, or a CRLF combination.  Terminates the string read</div><div class="line"> * with a null character.  If no newline indicator is found before the</div><div class="line"> * end of the buffer, the string is terminated with a null.  If any of</div><div class="line"> * the above three line terminators is read, the last character of the</div><div class="line"> * string will be a linefeed and the string will be terminated with a</div><div class="line"> * null character.</div><div class="line"> * Parameters: the socket descriptor</div><div class="line"> *             the buffer to save the data in</div><div class="line"> *             the size of the buffer</div><div class="line"> * Returns: the number of bytes stored (excluding null) */</div><div class="line">/**********************************************************************/</div><div class="line">int get_line(int sock, char *buf, int size)</div><div class="line">&#123;</div><div class="line"> int i = 0;</div><div class="line"> char c = &apos;\0&apos;;</div><div class="line"> int n;</div><div class="line">//标准化buf数组</div><div class="line"> while ((i &lt; size - 1) &amp;&amp; (c != &apos;\n&apos;))</div><div class="line"> &#123;</div><div class="line">  n = recv(sock, &amp;c, 1, 0);</div><div class="line">  /* DEBUG printf(&quot;%02X\n&quot;, c); */</div><div class="line">  if (n &gt; 0)</div><div class="line">  &#123;//继续接受</div><div class="line">   if (c == &apos;\r&apos;)</div><div class="line">   &#123;//接收窗口不划动</div><div class="line">    n = recv(sock, &amp;c, 1, MSG_PEEK);</div><div class="line">    /* DEBUG printf(&quot;%02X\n&quot;, c); */</div><div class="line">    if ((n &gt; 0) &amp;&amp; (c == &apos;\n&apos;))</div><div class="line">     recv(sock, &amp;c, 1, 0);//吸收换行符</div><div class="line">    else</div><div class="line">     c = &apos;\n&apos;;</div><div class="line">   &#125;</div><div class="line">   buf[i] = c;</div><div class="line">   i++;</div><div class="line">  &#125;</div><div class="line">  else</div><div class="line">   c = &apos;\n&apos;;</div><div class="line"> &#125;</div><div class="line"> buf[i] = &apos;\0&apos;;</div><div class="line"></div><div class="line"> return(i);</div><div class="line">&#125;</div><div class="line"></div><div class="line">/**********************************************************************/</div><div class="line">/* Return the informational HTTP headers about a file. */</div><div class="line">/* Parameters: the socket to print the headers on</div><div class="line"> *             the name of the file */</div><div class="line">/**********************************************************************/</div><div class="line">void headers(int client, const char *filename)</div><div class="line">&#123;//正常http首部</div><div class="line"> char buf[1024];</div><div class="line"> (void)filename;  /* could use filename to determine file type */</div><div class="line"></div><div class="line"> strcpy(buf, &quot;HTTP/1.0 200 OK\r\n&quot;);</div><div class="line"> send(client, buf, strlen(buf), 0);</div><div class="line">//服务器信息</div><div class="line"> strcpy(buf, SERVER_STRING);</div><div class="line"> send(client, buf, strlen(buf), 0);</div><div class="line"> sprintf(buf, &quot;Content-Type: text/html\r\n&quot;);</div><div class="line"> send(client, buf, strlen(buf), 0);</div><div class="line"> strcpy(buf, &quot;\r\n&quot;);</div><div class="line"> send(client, buf, strlen(buf), 0);</div><div class="line">&#125;</div><div class="line"></div><div class="line">/**********************************************************************/</div><div class="line">/* Give a client a 404 not found status message. */</div><div class="line">/**********************************************************************/</div><div class="line">void not_found(int client)</div><div class="line">&#123;</div><div class="line"> char buf[1024];</div><div class="line"></div><div class="line"> sprintf(buf, &quot;HTTP/1.0 404 NOT FOUND\r\n&quot;);</div><div class="line"> send(client, buf, strlen(buf), 0);</div><div class="line"> sprintf(buf, SERVER_STRING);</div><div class="line"> send(client, buf, strlen(buf), 0);</div><div class="line"> sprintf(buf, &quot;Content-Type: text/html\r\n&quot;);</div><div class="line"> send(client, buf, strlen(buf), 0);</div><div class="line"> sprintf(buf, &quot;\r\n&quot;);</div><div class="line"> send(client, buf, strlen(buf), 0);</div><div class="line"> sprintf(buf, &quot;&lt;HTML&gt;&lt;TITLE&gt;Not Found&lt;/TITLE&gt;\r\n&quot;);</div><div class="line"> send(client, buf, strlen(buf), 0);</div><div class="line"> sprintf(buf, &quot;&lt;BODY&gt;&lt;P&gt;The server could not fulfill\r\n&quot;);</div><div class="line"> send(client, buf, strlen(buf), 0);</div><div class="line"> sprintf(buf, &quot;your request because the resource specified\r\n&quot;);</div><div class="line"> send(client, buf, strlen(buf), 0);</div><div class="line"> sprintf(buf, &quot;is unavailable or nonexistent.\r\n&quot;);</div><div class="line"> send(client, buf, strlen(buf), 0);</div><div class="line"> sprintf(buf, &quot;&lt;/BODY&gt;&lt;/HTML&gt;\r\n&quot;);</div><div class="line"> send(client, buf, strlen(buf), 0);</div><div class="line">&#125;</div><div class="line"></div><div class="line">/**********************************************************************/</div><div class="line">/* Send a regular file to the client.  Use headers, and report</div><div class="line"> * errors to client if they occur.</div><div class="line"> * Parameters: a pointer to a file structure produced from the socket</div><div class="line"> *              file descriptor</div><div class="line"> *             the name of the file to serve */</div><div class="line">/**********************************************************************/</div><div class="line">void serve_file(int client, const char *filename)</div><div class="line">&#123;</div><div class="line"> FILE *resource = NULL;</div><div class="line"> int numchars = 1;</div><div class="line"> char buf[1024];</div><div class="line">//读取丢弃header</div><div class="line"> buf[0] = &apos;A&apos;; buf[1] = &apos;\0&apos;;</div><div class="line"> while ((numchars &gt; 0) &amp;&amp; strcmp(&quot;\n&quot;, buf))  /* read &amp; discard headers */</div><div class="line">  numchars = get_line(client, buf, sizeof(buf));</div><div class="line">//打开文件</div><div class="line"> resource = fopen(filename, &quot;r&quot;);</div><div class="line"> if (resource == NULL)</div><div class="line">  not_found(client);</div><div class="line"> else</div><div class="line"> &#123;//写首部，复制文件</div><div class="line">  headers(client, filename);</div><div class="line">  cat(client, resource);</div><div class="line"> &#125;</div><div class="line"> fclose(resource);</div><div class="line">&#125;</div><div class="line"></div><div class="line">/**********************************************************************/</div><div class="line">/* This function starts the process of listening for web connections</div><div class="line"> * on a specified port.  If the port is 0, then dynamically allocate a</div><div class="line"> * port and modify the original port variable to reflect the actual</div><div class="line"> * port.</div><div class="line"> * Parameters: pointer to variable containing the port to connect on</div><div class="line"> * Returns: the socket */</div><div class="line">/**********************************************************************/</div><div class="line">int startup(u_short *port)</div><div class="line">&#123;</div><div class="line"> int httpd = 0;</div><div class="line"> struct sockaddr_in name;</div><div class="line">//建立socket</div><div class="line"> httpd = socket(PF_INET, SOCK_STREAM, 0);</div><div class="line"> if (httpd == -1)</div><div class="line">  error_die(&quot;socket&quot;);</div><div class="line"> memset(&amp;name, 0, sizeof(name));</div><div class="line"> name.sin_family = AF_INET;</div><div class="line"> name.sin_port = htons(*port);</div><div class="line"> name.sin_addr.s_addr = htonl(INADDR_ANY);</div><div class="line"> if (bind(httpd, (struct sockaddr *)&amp;name, sizeof(name)) &lt; 0)</div><div class="line">  error_die(&quot;bind”);</div><div class="line">//动态随机分配</div><div class="line"> if (*port == 0)  /* if dynamically allocating a port */</div><div class="line"> &#123;</div><div class="line">  socklen_t namelen = sizeof(name);</div><div class="line">  if (getsockname(httpd, (struct sockaddr *)&amp;name, &amp;namelen) == -1)</div><div class="line">   error_die(&quot;getsockname&quot;);</div><div class="line">  *port = ntohs(name.sin_port);</div><div class="line"> &#125;</div><div class="line">//开始监听</div><div class="line"> if (listen(httpd, 5) &lt; 0)</div><div class="line">  error_die(&quot;listen&quot;);</div><div class="line"> return(httpd);</div><div class="line">&#125;</div><div class="line"></div><div class="line">/**********************************************************************/</div><div class="line">/* Inform the client that the requested web method has not been</div><div class="line"> * implemented.</div><div class="line"> * Parameter: the client socket */</div><div class="line">/**********************************************************************/</div><div class="line">void unimplemented(int client)</div><div class="line">&#123;//method不被支持</div><div class="line"> char buf[1024];</div><div class="line"></div><div class="line"> sprintf(buf, &quot;HTTP/1.0 501 Method Not Implemented\r\n&quot;);</div><div class="line"> send(client, buf, strlen(buf), 0);</div><div class="line"> sprintf(buf, SERVER_STRING);</div><div class="line"> send(client, buf, strlen(buf), 0);</div><div class="line"> sprintf(buf, &quot;Content-Type: text/html\r\n&quot;);</div><div class="line"> send(client, buf, strlen(buf), 0);</div><div class="line"> sprintf(buf, &quot;\r\n&quot;);</div><div class="line"> send(client, buf, strlen(buf), 0);</div><div class="line"> sprintf(buf, &quot;&lt;HTML&gt;&lt;HEAD&gt;&lt;TITLE&gt;Method Not Implemented\r\n&quot;);</div><div class="line"> send(client, buf, strlen(buf), 0);</div><div class="line"> sprintf(buf, &quot;&lt;/TITLE&gt;&lt;/HEAD&gt;\r\n&quot;);</div><div class="line"> send(client, buf, strlen(buf), 0);</div><div class="line"> sprintf(buf, &quot;&lt;BODY&gt;&lt;P&gt;HTTP request method not supported.\r\n&quot;);</div><div class="line"> send(client, buf, strlen(buf), 0);</div><div class="line"> sprintf(buf, &quot;&lt;/BODY&gt;&lt;/HTML&gt;\r\n&quot;);</div><div class="line"> send(client, buf, strlen(buf), 0);</div><div class="line">&#125;</div><div class="line"></div><div class="line">/**********************************************************************/</div><div class="line"></div><div class="line">int main(void)</div><div class="line">&#123;</div><div class="line"> int server_sock = -1;</div><div class="line"> u_short port = 0;</div><div class="line"> int client_sock = -1;</div><div class="line"> struct sockaddr_in client_name;</div><div class="line"> socklen_t client_name_len = sizeof(client_name);</div><div class="line"> pthread_t newthread;</div><div class="line">//建立httpd服务</div><div class="line"> server_sock = startup(&amp;port);</div><div class="line"> printf(&quot;httpd running on port %d\n&quot;, port);</div><div class="line"></div><div class="line"> while (1)</div><div class="line"> &#123;//收到客户端链接请求</div><div class="line">  client_sock = accept(server_sock,</div><div class="line">                       (struct sockaddr *)&amp;client_name,</div><div class="line">                       &amp;client_name_len);</div><div class="line">  if (client_sock == -1)</div><div class="line">   error_die(&quot;accept&quot;);</div><div class="line"> /* accept_request(client_sock); */</div><div class="line"> if (pthread_create(&amp;newthread , NULL, accept_request, (void *)&amp;client_sock) != 0)</div><div class="line">   perror(&quot;pthread_create&quot;);</div><div class="line"> &#125;</div><div class="line"></div><div class="line"> close(server_sock);</div><div class="line"></div><div class="line"> return(0);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>(2)在makefile文件</strong>中改为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gcc -W -Wall -o httpd httpd.c -lpthread</div></pre></td></tr></table></figure>
<p>make完结果</p>
<p><img src="http://img.blog.csdn.net/20160730211549112" alt="这里写图片描述"></p>
<p><strong>TinyHttpd使用</strong><br>1.运行应用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">./httpd</div></pre></td></tr></table></figure>
<p><img src="http://img.blog.csdn.net/20160730212735910" alt="这里写图片描述"></p>
<p>得到端口号为52870</p>
<p>2.在浏览器firefox中输入地址</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">http://localhost:52870</div></pre></td></tr></table></figure>
<p><img src="http://img.blog.csdn.net/20160730212834364" alt="这里写图片描述"></p>
<p><strong>TinyHttpd源码分析</strong></p>
<p>1.函数功能如下</p>
<pre><code>accept_request:  处理从套接字上监听到的一个 HTTP 请求，在这里可以很大一部分地体现服务器处理请求流程。

bad_request: 返回给客户端这是个错误请求，HTTP 状态吗 400 BAD REQUEST.

cat: 读取服务器上某个文件写到 socket 套接字。

cannot_execute: 主要处理发生在执行 cgi 程序时出现的错误。

error_die: 把错误信息写到 perror 并退出。

execute_cgi: 运行 cgi 程序的处理，也是个主要函数。

get_line: 读取套接字的一行，把回车换行等情况都统一为换行符结束。

headers: 把 HTTP 响应的头部写到套接字。

not_found: 主要处理找不到请求的文件时的情况。

sever_file: 调用 cat 把服务器文件返回给浏览器。

startup: 初始化 httpd 服务，包括建立套接字，绑定端口，进行监听等。

unimplemented: 返回给浏览器表明收到的 HTTP 请求所用的 method 不被支持。
</code></pre><p>2.注释详细如上</p>
<p><strong>[综合]WebBench测试TinyHttpd</strong><br>基本如上<br>1.用TinyHttpd小型web服务器<br><img src="http://img.blog.csdn.net/20160730213630744" alt="这里写图片描述"></p>
<p>2.用WebBench对地址进行测试<br><img src="http://img.blog.csdn.net/20160730213753057" alt="这里写图片描述"></p>
<p>出现错误</p>
<blockquote>
<p>全部failed且TinyHttpd自动断开</p>
</blockquote>
<p>开始以为并发数的问题，减小后并未改善</p>
<p><img src="http://img.blog.csdn.net/20160730214014480" alt="这里写图片描述"></p>
<p>网上查阅资料后</p>
<p><strong>解决方法</strong></p>
<p>（1）原因</p>
<blockquote>
<p>因为WebBench在一次访问完之后就断掉了，但是TinyHttpd要分次把一个网页的内容发送给WebBench，所以第一次发的时候是成功的，第二次就失败了。而且TinyHttpd在send的时候没有异常判断和处理，所以程序卡死</p>
</blockquote>
<p>（2）解决<br><strong>httpd.c的unimplemented中将后面的14行代码发送注释掉</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">void unimplemented(int client)</div><div class="line">&#123;</div><div class="line"> char buf[1024];</div><div class="line"></div><div class="line"> sprintf(buf, &quot;HTTP/1.0 501 Method Not Implemented\r\n&quot;);</div><div class="line"> send(client, buf, strlen(buf), 0);</div><div class="line"> /*sprintf(buf, SERVER_STRING);</div><div class="line"> send(client, buf, strlen(buf), 0);</div><div class="line"> sprintf(buf, &quot;Content-Type: text/html\r\n&quot;);</div><div class="line"> send(client, buf, strlen(buf), 0);</div><div class="line"> sprintf(buf, &quot;\r\n&quot;);</div><div class="line"> send(client, buf, strlen(buf), 0);</div><div class="line"> sprintf(buf, &quot;&lt;HTML&gt;&lt;HEAD&gt;&lt;TITLE&gt;Method Not Implemented\r\n&quot;);</div><div class="line"> send(client, buf, strlen(buf), 0);</div><div class="line"> sprintf(buf, &quot;&lt;/TITLE&gt;&lt;/HEAD&gt;\r\n&quot;);</div><div class="line"> send(client, buf, strlen(buf), 0);</div><div class="line"> sprintf(buf, &quot;&lt;BODY&gt;&lt;P&gt;HTTP request method not supported.\r\n&quot;);</div><div class="line"> send(client, buf, strlen(buf), 0);</div><div class="line"> sprintf(buf, &quot;&lt;/BODY&gt;&lt;/HTML&gt;\r\n&quot;);</div><div class="line"> send(client, buf, strlen(buf), 0);*/</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>3.make重新编译</p>
<p>4.运行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">./httpd</div></pre></td></tr></table></figure>
<p>运行结果全部成功</p>
<p><img src="http://img.blog.csdn.net/20160730214417824" alt="这里写图片描述"></p>
<p>[总结]<br>小小的预告！<br>下一篇会详细解释最后最综合的网络实验，从一开始搜bing到有时候科学上网google，再到后面看cnblog、csdn找到有用的答案或错误分享解决方案，到逐渐从github找到大神。</p>
<p>结论：最make sense的还是开发者的README.md，自己编的程序自己最清楚嘛，次之是github的大神或者stackflow。对英文有一定要求。至于bing、google搜出来的答案当然也会有用的但是鱼龙混杂，能找到有帮助但却浪费了一定时间。</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/vim/" rel="tag"># vim</a>
          
            <a href="/tags/opensource/" rel="tag"># opensource</a>
          
            <a href="/tags/WebBench/" rel="tag"># WebBench</a>
          
            <a href="/tags/TinyHttpd/" rel="tag"># TinyHttpd</a>
          
            <a href="/tags/wget/" rel="tag"># wget</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/07/27/CentOS-on-Mac-3-进程通信/" rel="next" title="CentOS on Mac#3.进程通信 ">
                <i class="fa fa-chevron-left"></i> CentOS on Mac#3.进程通信 
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/08/01/CentOS-on-Mac-5-OpenVSwitch＋mininet/" rel="prev" title="CentOS on Mac#5.OpenVSwitch＋mininet ">
                CentOS on Mac#5.OpenVSwitch＋mininet  <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/and.jpg"
               alt="Izzy Qiu" />
          <p class="site-author-name" itemprop="name">Izzy Qiu</p>
           
              <p class="site-description motion-element" itemprop="description">Coding | Life | Music | Travel</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">19</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">3</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">72</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/yzziqiu" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                    
                      GitHub
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="yisiqiu dot izzy at gmail dot com" target="_blank" title="E-mail">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                    
                      E-mail
                    
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Izzy Qiu</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  

<div id="disqus_thread"></div>
<script>
/**
* RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
* LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');

s.src = '//.disqus.com/embed.js';

s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>



	





  





  






  





  

  

  

  

  

  

</body>
</html>
